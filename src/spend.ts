import { Blockfrost, CML, Data, fromText, getAddressDetails, Lucid, Maestro, UTxO } from "@lucid-evolution/lucid";
import { generateSpendScript, getSpendRedeemer, readValidators, getInput, serialiseReferenceInputs, serialiseBody, generateMintPolicy, spendTx, ZKProof, ZkInput } from "./prepare-contracts";
import * as fs from 'fs';
import {} from "@lucid-evolution/lucid/dist/index"


// console.log('Deserialise (Lucid-Evolution)', CML.PlutusData.from_cbor_hex("D8799F9FD8799F5820B8B523B596040BB749B23848EA976EE238D5693DCA8DAA3771E17F3874A9C17E00FFFF9FD8799F58203658CF03AB7407F816548E5A465B6F51779BE54BB45F57155776864E454804AC00FFFF9FD8799FD8799FD8799F581C3DCE7844F36B23B8C3F90AFBA40AA188E7F1D3F6E8ACD1D544ED1DA9FFD87A80FF49A140A1401A0098968040D87A80FFD8799FD8799FD8799F581C3DCE7844F36B23B8C3F90AFBA40AA188E7F1D3F6E8ACD1D544ED1DA9FFD87A80FF49A140A1401A025CE88B40D87A80FFFF41A080FF").to_json());

// console.log('Deserialise (Aiken)', CML.PlutusData.from_cbor_hex('D8799F9FD8799F5820B8B523B596040BB749B23848EA976EE238D5693DCA8DAA3771E17F3874A9C17E00FFFF9FD8799F58203658CF03AB7407F816548E5A465B6F51779BE54BB45F57155776864E454804AC00FFFF9FD8799FD8799FD8799F581C3DCE7844F36B23B8C3F90AFBA40AA188E7F1D3F6E8ACD1D544ED1DA9FFD87A80FF49A140A1401A0098968040D87A80FFD8799FD8799FD8799F581C3DCE7844F36B23B8C3F90AFBA40AA188E7F1D3F6E8ACD1D544ED1DA9FFD87A80FF49A140A1401A025CC80F40D87A80FFFF41A080FF').to_json());

// console.log("TX", CML.Transaction.from_cbor_hex("84a900828258201d45a780d06d00b1d4114560439a20c3c4f964bdd85620a58d9c74c04efca3360082582061ffcafdefa3d05f7192aef8a9e7123c694308e4926dd500e5dcda97d94b4790020183a300581d70cc49522be14a375bdc938d34513c7627279e5efe4e8acf85acdb40fc01821a002c7518a1581c86209f6e1a7fa91f9d1d28f2e572108f2c13cd4ef7fd990991b0afdba144486f6c6101028201d8185901aed8799f582038501ae44d42c47cd8555261404afe8575a4ecb2845d8dce649ab56818417a19581c1710b43f9d3514cb77fffeda0aa52fb2179e90b4a17b12ddae1cf39a46497373756564d8799fa143373231a158383836323039663665316137666139316639643164323866326535373231303866326331336364346566376664393930393931623061666462a144486f6c61ad446e616d6544486f6c6144636974794c4275656e6f7320416972657347636f756e74727949417267656e74696e6146636f75727365581943617264616e6f20446576656c6f7065727320436f7572736544646174654a323032342d30372d323946656e7469747948465242412055544e45686f75727342353045696d6167655f5840697066733a2f2f62616679626569686c696f75746374346736346862677a636e33766a746e3336377779736b77777176797976766d6a376f6874646464746237426134ff4669737375657243494f4746737461747573465061737365644773747564656e7451436861726c657320486f736b696e736f6e44747970654a417474656e64616e63654576656e756544414c424101d87a80ffff82583900604ffb1a3056653482a39da01f5a03eaf2339b5277efef4768b17e4c27c3dc58f6671fb46a054ec349230de1f0902cc6b85459b7eac4c1a0821a0012050ca1581c4084c311448c4d9bfa49c7cf6c83d7b1bb54ced13296e6a2d4211196a14a5465737420414c4445411a0098968082583900604ffb1a3056653482a39da01f5a03eaf2339b5277efef4768b17e4c27c3dc58f6671fb46a054ec349230de1f0902cc6b85459b7eac4c1a01b0000000254070260021a000e1edc031a04cf17fe09a1581c86209f6e1a7fa91f9d1d28f2e572108f2c13cd4ef7fd990991b0afdba144486f6c61010b58207bd5229bb52a2f0fb3514622fc336f418a7aa8023f53364214fd4ea5ece08ad80d818258201d45a780d06d00b1d4114560439a20c3c4f964bdd85620a58d9c74c04efca336001082583900604ffb1a3056653482a39da01f5a03eaf2339b5277efef4768b17e4c27c3dc58f6671fb46a054ec349230de1f0902cc6b85459b7eac4c1a0821b0000000253f221d6a1581c4084c311448c4d9bfa49c7cf6c83d7b1bb54ced13296e6a2d4211196a14a5465737420414c4445411a00989680111a00152e4aa20581840100d8799f46497373756564a2581c604ffb1a3056653482a39da01f5a03eaf2339b5277efef4768b17e4cd8799f58206ad4eef890b91d103943b9a23d8d91227f465f7f0d327d97714e492333c814a3583900604ffb1a3056653482a39da01f5a03eaf2339b5277efef4768b17e4c27c3dc58f6671fb46a054ec349230de1f0902cc6b85459b7eac4c1a0d8799f4a5369676e6174757265315f5840a201276761646472657373583900604ffb1a3056653482a39da01f5a03eaf2339b5277efef4768b17e4c27c3dc58f6671fb46a054ec349230de1f0902cc6b8544659b7eac4c1a0ffd87a80d8799f40ff58255349474e7c38501ae44d42c47cd8555261404afe8575a4ecb2845d8dce649ab56818417a19ff58403d465bfea4e9a27c0273fa2f4af945d01db29a37a1dfda842e11ddc8f4b0ce367245501a0f19c4e5f1315c2bde29cfeb8e3e824cb567ce25239bddfc0147a10aff581c1710b43f9d3514cb77fffeda0aa52fb2179e90b4a17b12ddae1cf39ad8799f5820edeacf731f9a69d0be4de917499a0f9cebd5ec132e567be3e791335d14a1b1f35839001710b43f9d3514cb77fffeda0aa52fb2179e90b4a17b12ddae1cf39a4ac49663d07a8e495865ec02db6d4904cfb66fe262be8c5b01f0fe12d8799f4a5369676e6174757265315f5840a2012767616464726573735839001710b43f9d3514cb77fffeda0aa52fb2179e90b4a17b12ddae1cf39a4ac49663d07a8e495865ec02db6d4904cfb66fe262be468c5b01f0fe12ffd87a80d8799f40ff58255349474e7c38501ae44d42c47cd8555261404afe8575a4ecb2845d8dce649ab56818417a19ff5840db421093fa0653d0e236ba2ac58e4f5c3ae376a4ffef3b2d65ca0d405410b0be2d846c7193c90a5afc73b4ce61b915876c2cc69441663236f3430d94473f6d0fffff821a004a2d3d1a6b795f3f06815918ca5918c70100003323232323232323232323232323222323232322533300d3233323232323232323232323222533301b3011301d3754002264646464a66603e602c60426ea80044c8c8c8c94ccc08cc068c094dd500d8991919299981319b8f00248810649737375656400132533302b001153302802316132533302c302f0021323232533302b3022302d3754002264646464a6660660022a660600582c264a666068606e004264a666062a666062a666062a66606266e3c024dd718198010a5115330324912061737365745f6e616d65203d3d20746f6b656e5f6e616d65203f2046616c73650014a02a666062a66606266e1c0200045288a9981924811e616d6f756e74203d3d20746f6b656e5f616d6f756e74203f2046616c73650014a02604e01029405280a5113330314a294128899299919819999119191919191919191919299981f981a8008a99981f981b18209baa002132330010013758608c60866ea800c894ccc11400452889929998211999816982400100e8070078998018018008a50304800114a02a66607e601a0022a66607e606c60826ea80084c8cc004004dd6182318219baa00322533304500114a0264a666084666605a609000403a01c01e29444cc00c00c004c1200045280a99981f99b87480180044c8c8c8c94ccc10cc0e8c114dd50010992999822181d98231baa0041337126eb4c128c11cdd500219198008008011129998250008a400026644a666090666606600404602802a266e0000520021001304c00133002002304d00100237586092608c6ea80080045281823801182318238009982200119822001a5eb804cccc0a8c0b0cc110024cc11001ccc110014cc11000d2f5c003401601860806ea8020c10cc110008c108004c108008c100004c100008c0f8004c0f8008c0f0004c0e0dd500e181c981d181d181d181d181d181d181d181b1baa016302033038375266e29221055349474e7c000024bd70099299981a1815000899299981a9816181b9baa0011533303533301d303b30383754002022008294454cc0d924012a636865636b5f646174756d28646174612c206d73672c20706f6c6963794861736829203f2046616c73650014a02a6606c9213a65787065637420536f6d65286461746129203d2066696e645f646174756d285b6f75747075745d2c20646963742e6e657728292c20686173682900163322325333037302d30393754002264a6660780022980103d87a8000130253303d303e0014bd70191980080080211299981e8008a5eb804c8c94ccc0ecc0c4c0f4dd50008998020020010998201820981f1baa0013300400400232533303b3009303d3754002264a66607866e3cdca1bb300100713029330410014bd700a6103d87a80003041303e37540022980103d87a8000304030413041303d37546080004608000220026604497adef6c60001330390094bd701bae303a3037375400e2a66606860040022a6660686660386074606e6ea801c04000c5288a9981aa4812a636865636b5f646174756d28646174612c206d73672c20706f6c6963794861736829203f2046616c73650014a02a6660689405288a9981aa490d46616c7365203f2046616c73650014a0606a6ea8018dc3a40082a660669201b16578706563740a2020202020202020636865636b5f706f6c696379280a202020202020202020207472616e73616374696f6e2e76616c69646974795f72616e67652c0a20202020202020202020706f6c6963792c0a202020202020202020207369676e6174757265732c0a20202020202020202020536f6d65286279746561727261792e636f6e63617428232235333439343734653763222c20706f6c6963794861736829292c0a202020202020202029001637286ecc06054cc0c92401746578706563740a2020202020202020280a202020202020202020202861737365745f6e616d65203d3d20746f6b656e5f6e616d65293f2026262028616d6f756e74203d3d20746f6b656e5f616d6f756e74293f20262620616d6f756e74203d3d20310a202020202020202029203d3d20547275650016375a60660022a6606205a2c606a0026602e6eacc0d000803cc0ccc0d0004c0ccc0bcdd5000981898171baa001153302c4901ff65787065637420536f6d65286f757470757429203d0a20202020202020206c6973742e66696e64280a202020202020202020206f7574707574732c0a20202020202020202020666e286f757470757429207b0a2020202020202020202020206c65742041646472657373207b207061796d656e745f63726564656e7469616c2c202e2e207d203d206f75747075742e616464726573730a2020202020202020202020207768656e207061796d656e745f63726564656e7469616c206973207b0a202020202020202020202020202053637269707443726564656e7469616c286861736829202d3e202868617368203d3d207363726970745f68617368293f0a3e20202020202020202020202020205f202d3e2046616c73653f0a2020202020202020202020207d0a202020202020202020207d2c0a2020202020202020290016323300100100a22533303000114c0103d87a800013232533302e32533302f3025303137540022a66605e66e3cdd7181a98191baa00101414a22a660609211b68617368203d3d207363726970745f68617368203f2046616c73650014a02a66605e9405288a998182490d46616c7365203f2046616c73650014a0606860626ea8c078c0c4dd50010980d9981980125eb804cc010010004c0d0008c0c8004dd698160011bae302a001153302902416302d0013300f3010004007153302749116657870656374206d7367203d3d20224973737565642200163756605660580046eb8c0a8004c098dd500d89919800800991980080098078019129998150008a5eb804c8ccc888c8cc00400400c894ccc0c0004400c4c8cc0c8dd3998191ba900633032302f0013303230300014bd7019801801981a00118190009bae30290013756605400266006006605c004605800244a66605200229444c94ccc098c8c94ccc0a0ccc0a0cdc79bae302e0020094a0944528899b8700148004dd69816981718170009bac302c00213300300300114a060580026eacc0a0c0a4c0a4008dd618138009813981398119baa003375c604a60446ea800454cc081241236578706563742074782e4d696e7428706f6c6963795f696429203d20707572706f73650016302430250023023001301f37540206eb8c084c078dd50008a9980e24812d6578706563742053637269707443726564656e7469616c287363726970745f6861736829203d20736372697074001622232533301c3013301e3754002264a6660420022a6603c0362c26464a6660460022a6604003a2c26464a66604a0022a6604403e2c26464a66604e0022a660480422c264a6660506056004264a66604aa66604a66e3c02002c5288a9981324811e706f6c6963794964203d3d20706f6c69637948617368203f2046616c73650014a02a66604aa66604a66e1cdc680424080294454cc0992401286279746561727261792e6c656e67746828706f6c696379496429203d3d203332203f2046616c73650014a0266e3c0100305280a505333024301b30263754002264a6660520022a6604c0462c26464a6660560022a6605004a2c26464a66605a0022a6605404e2c264a66605c606200426493192999815981100089929998180008a998168150b0992999818981a0010a4c2a6605c0562c6064002605c6ea800854ccc0acc08400454ccc0bcc0b8dd50010a4c2a660580522c2a660580522c60586ea800454cc0ac0a058c94cccccc0c8004400454cc0ac0a05854cc0ac0a05854cc0ac0a05854cc0ac0a058c0bc004c0bc008c94cccccc0c000454cc0a40985854cc0a40985854cc0a4098584dd68008a998148130b18168009816801181580098139baa00115330250221615330250221632533333302c00110011533025022161533025022161533025022161533025022163029001302900232533333302a0011533023020161533023020161533023020161533023020161375c002604e002604e00464a6666660500022a6604203c2c2a6604203c2c2a6604203c2c2a6604203c2c26eb8004c094004c094008c94cccccc09800454cc07c0705854cc07c0705854cc07c0705854cc07c070584dd70009811800980f9baa001153301d01a1653333330230031003153301c01916153301c01916153301c01916153301c019162232533301a3010301c3754002297adef6c60137566040603a6ea8004c8cc00400400c894ccc07c0045300103d87a8000132323232533301f3372200e0042a66603e66e3c01c0084c030cc090dd3000a5eb80530103d87a8000133006006003375660420066eb8c07c008c08c008c0840048c8cc004004008894ccc07400452f5bded8c0264646464a66603a66e452201000021533301d3371e91010000210031005133022337606ea4008dd3000998030030019bab301f003375c603a0046042004603e00244446464646464a66603c602a0022a66603c602a60406ea800c4c94ccc07cc058c084dd5004099192999810980c18119baa00113232325330253372c92010a69732076616c69643f20000011533302400214a226660489452825153330230011490104547275650014910546616c7365003232323232323253330293371e00c6eb8c064c0b0dd5004099191919191919299981819b8f0110011325330323372c92011a5369676e6564204d65737361676520286f6e636861696e293a200030230011533303133372a01c00201229444ccdca80719191929981a99b9649011b5369676e6564204d65737361676520284d616e75616c6c79293a20003026001100132323232323371400203266e28004c8cdc5800a4500371a03066e280052210158003371400291010140003371400200666e2922010d846a5369676e617475726531580033716002910100371a0026466e28004034cdc524410ca20127676164647265737358003233716002910100371a0180126eccdd3991998008009981b1ba9002330363752a666062604e60666ea800c52201001375c606e60686ea800ccc0d8dd48029981b1ba90074bd7025eb808894ccc0dc00840044ccc00c00cc0e8008cc0e0c0e400800454cc0c5240115657870656374206d7367203d3d207061796c6f61640016375c606a606c0046068002606860680046eb8c0c8004c0c8008dd7181800098161baa002153302a49114657870656374206b6579203d3d207075624b65790016375c605c605e004605a002605a0046eb8c0ac004c0ac008dd7181480098129baa0013027302437540022a6604492012f65787065637420536f6d6528636f646553696729203d20646963742e676574287369676e446963742c20686173682900163300c300e00a002375c604a60446ea802054cc0812411a65787065637420536f6d65286d736729203d206d6573736167650016375c604860426ea800c54cc07d24011b65787065637420536f6d65286861736829203d206b65794861736800161533301e3370e90040008a99980f180a98101baa002132325333020301630223754002264a66604264a66604c604a0022a66604460306048002294454ccc088c064c0900045280b0b1baa301230243754602260486ea80244cdc4001800899b89003001375a604c60466ea8004528180798111baa300f3022375400e6eb4c090c084dd50010a9980f80e8b0a99980f19b874802800454ccc078c054c080dd5001099192999810180b18111baa00113253330213253330263025001153330223018302400114a22a6660446032604800229405858dd5180918121baa301230243754012266e2000400c4cdc48008019bad3026302337540022940c03cc088dd5180818111baa007375a604860426ea800854cc07c07458528180f9baa30230043022302300230210013021001301c375400844646600200200644a666038002298103d87a8000132323232533301c3372200e0042a66603866e3c01c0084c024cc0840052f5c0298103d87a8000133006006003301e003375c60380046040004603c0026e952000300100122533301700114bd6f7b630099199911191980080080211299980e80089980f19bb0375200800697adef6c60132323232533301d3372001000426604466ec0dd48040038028a99980e99b8f008002133022337606ea402001c00c4cc088cdd81ba900200133006006003301f003375c603a0046042004603e0026600600660360046eb8c058004c05c004c0640048c05c0048c058c05c0048dcc9919980080099b80371a0049000a4410022253330123371000490000800899191919980300319b8000548004cdc599b80002533301533710004900a0a40c0290570099b8b33700002a66602a66e200052014148180520ae010043370c004901019b8300148080cdc7002001180a000980a180a80098081baa007149854cc03924011856616c696461746f722072657475726e65642066616c736500136563232533300d30040011325333012001153300f00916132325333014001153301100b1613253330153018002132498c8cc004004008894ccc05c00452613233003003301b0023232325333016300d30183754002264a6660360022a660300242c26464a66603a0022a660340282c26464a66603e0022a6603802c2c26464a6660420022a6603c0302c264a666044604a00426493299980f180a98101baa0031325333023001153302001a16132325333025001153302201c16132325333027001153302401e1613232533302900115330260201613232533302b001153302802216132533302c302f00213232498cc078010090cc07401408c54cc0a408c58c94cccccc0c000454cc0a408c5854cc0a408c5854cc0a408c5854cc0a408c584dd70009816800981680119299999981700088008a998138108b0a998138108b0a998138108b0a998138108b1815800981580119299999981600088008a9981280f8b0a9981280f8b0a9981280f8b0a9981280f8b181480098148011929999998150008a9981180e8b0a9981180e8b0a9981180e8b0a9981180e8b09bae00130270013027002325333333028001153302101b16153302101b16153302101b16153302101b161375c002604a00260426ea800c54cc07c0645854cc07c06458c94cccccc09800454cc07c0645854cc07c0645854cc07c0645854cc07c064584dd70009811800981180119299999981200088008a9980e80b8b0a9980e80b8b0a9980e80b8b0a9980e80b8b181080098108011929999998110008a9980d80a8b0a9980d80a8b0a9980d80a8b0a9980d80a8b09bae001301f001301f0023253333330200011533019013161533019013161533019013161533019013161375c002603a00260326ea800454cc05c04458c94cccccc078004400454cc05c0445854cc05c0445854cc05c0445854cc05c04458c060008c94cccccc07400454cc0580405854cc0580405854cc0580405854cc058040584dd7000980b000980c8008a998090060b19299999980c8008a998090060b09bab001153301200c16153301200c16153301200c1630160013016002325333333017001153301000a16153301000a16153301000a16153301000a161375c002602800260206ea801454ccc034c00c00454ccc044c040dd50028a4c2a6601c0102c2a6601c0102c601c6ea801088c94ccc038c0140044c94ccc04c00454cc04000c584c94ccc050c05c0085261533011004163253333330180011533011004161533011004161533011004161533011004161375c002602a00260226ea800c54ccc038c01000454ccc048c044dd50018a4c2a6601e0042c2a6601e0042c601e6ea8008dc3a40046e1d20005333333010001100115330090031615330090031615330090031615330090031649011672656465656d65723a2052656465656d65724461746100490197657870656374205b506169722861737365745f6e616d652c20616d6f756e74295d203d0a20202020202020206d696e740a202020202020202020207c3e2076616c75652e66726f6d5f6d696e7465645f76616c75650a202020202020202020207c3e2076616c75652e746f6b656e7328706f6c6963795f6964290a202020202020202020207c3e20646963742e746f5f7061697273282900490177657870656374205b5061697228746f6b656e5f6e616d652c20746f6b656e5f616d6f756e74295d203d0a202020202020202076616c0a202020202020202020207c3e2076616c75652e746f6b656e7328706f6c6963795f6964290a202020202020202020207c3e20646963742e746f5f706169727328290049013b65787065637420446174756d44617461207b20706f6c69637949642c207374617475732c202e2e207d3a20446174756d44617461203d20646174610049011c65787065637420536f6d652874696d65536c6f7429203d20736c6f74005734ae7155ceaab9e5573eae815d0aba25748981abd8799fd8799fd87a80d87a80d87a80d87a80d8799f9fd8799fd87980d8799f581c604ffb1a3056653482a39da01f5a03eaf2339b5277efef4768b17e4cffd87a80d87a80ffd8799fd87980d8799f581c1710b43f9d3514cb77fffeda0aa52fb2179e90b4a17b12ddae1cf39affd87a80d87a80ffffffffd87a9f581ccc49522be14a375bdc938d34513c7627279e5efe4e8acf85acdb40fcff509822322a5dd848503765d5e07bbab223ff0001f5f6").to_json());
// console.log("TX", CML.Transaction.from_cbor_hex("").to_json());

// const network = "Preprod";
const network = "Preview";
const lucid = await Lucid(
    new Blockfrost(
        "https://cardano-preview.blockfrost.io/api/v0",
        "preview1OQSKlQ6tb3WYBx9bqlz7kDFhuglmfvL"
        // "https://cardano-preprod.blockfrost.io/api/v0",
        // "preprodNQK7GqWxfMkWg9x5j4bHOVBNNGpjmxQv"
    ),
    network
);
// const lucid = await Lucid(
//     new Maestro({
//         apiKey: "M4tGNWFPzrC35t3HW5LVEkcH8tvO0FkS",
//         network
//     }),
//     network
// );

const prvKey = fs.readFileSync('./src/me.sk').toString();
lucid.selectWallet.fromPrivateKey(prvKey);
// const walletAddress = await lucid.wallet().address();
const walletAddress = "addr_test1qzw567xyzgqchtyddeha90ugsr8uyu7h4uh8wg5su8qz7yykq2ndwcmedv72l7263vj96tl6cyn74l2mw5kp8h7fk8rq66qtae";

const policyId = "b8a5e329b500a66376047165cdfce62c3ecf245fd81d101533f81422";
const lovelace = 10_000_000n;
const tokenName = fromText('Fontus#000');
console.log('Token Name:', tokenName);
const assetUnit = `${policyId}${tokenName}`;

const validators = readValidators();
const { spend, spendAddress } = generateSpendScript(validators.spend.script, network, policyId, tokenName);
console.log('Spend Address:', spendAddress);
// console.log('Spend Script:', spend);

const utxoRef: UTxO = {
    address: "addr_test1vq7uu7zy7d4j8wxrly90hfq25xyw0uwn7m52e5w4gnk3m2gprf2za",
    // address: spendAddress,
    txHash: "d6da036c1aeb7680323258c763a2a6e25be9b280c2a8fedd5e43cb89730fdadf",
    // txHash: "0000000000000000000000000000000000000000000000000000000000000000",
    outputIndex: 0,
    // assets: { lovelace: BigInt(4_219_490), ["b8a5e329b500a66376047165cdfce62c3ecf245fd81d101533f81422466f6e74757323303030"]: BigInt(1) },
    assets: { lovelace: 4_366_030n, [assetUnit]: 1n },
    datum: "d8799f4a466f6e74757323303030582016de4e0412334a7a78664ef6307117e601c9db5213b7ea96a1edf1d1fab543ded8799f5830b18db01619508d589ba45cdcc9c9ab4dbddc33e08bc4dbddea565c10dc743fd66510d3f49c6343999caf540eaa0c4e035f5840845f7a4f6d0fbcaf0648d9c2657f19a33f4e2124c284d68688f209abf54d5a1d1afc47de55c24e662c47f7632a760a8016e8ba01eb4b0d4a2db67fe5abed5ae15820a09e035dbe984a1426e440a4f0038276792f87cdb2bc35dc185a618d352d7f54ff5f584093e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc510515820c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8ff5f5840a2341a098a95305955386a3e0e4e2879e6206342b9c9a8da0559190e82f3ed1478158f2ca1ef4db7deab124b7c85b0f403d1a968b4812e6c9c9392d926b86da5582001e23f6c94cffcc62b02393d7807a6f381e40ca49a9b4a2b522518f72927ca15ff9f5830ac2fcd68b85b64e6c3bc11a9dadd1b24e7786738475cf2fe0acdd9b41f773af18ec12601e368d2e920f299f9e6bed4805830a33061a2549ea773d275539b2e92caa6f936404635db1da3199ec71f06faf2cba8effef6860bcb0376259a681ef043c35830a3f6177ea5ef5797249df745be266271bd65a6a1c9c9fae2df3dd2c7e9e6b5751f288fba11950455a9a1f9a054bad8545830a5d227c013957479be181bf43c394a49e8bf14585fd04a4ca72102e3e5ab41661411eeb15986ad3d3a09eb25bb2b7b12583093a152a9cd7d4b81a08989f67fcb958e96b14ef4d3cefd26ad992059df4d252a9f00b5f9f2b5b8a59cf4eca9d78848935830b8cd6daceeaa3b53d707ae2b99dc87e0dbbf58a1e310cff5cd3bea151d90962372de834a519a879c05bc470a016202d65830a6b5d4a12faf84ac46dba1793716cdb14009af64d0edcd5f1c0ca872fa53bc5732da912222fc3d4fc7ea2fc1b9fbff41ffffff"
    // datum: "D8799F58200000000000000000000000000000000000000000000000000000000000000237D8799F5830B18DB01619508D589BA45CDCC9C9AB4DBDDC33E08BC4DBDDEA565C10DC743FD66510D3F49C6343999CAF540EAA0C4E035F5840845F7A4F6D0FBCAF0648D9C2657F19A33F4E2124C284D68688F209ABF54D5A1D1AFC47DE55C24E662C47F7632A760A8016E8BA01EB4B0D4A2DB67FE5ABED5AE15820A09E035DBE984A1426E440A4F0038276792F87CDB2BC35DC185A618D352D7F54FF5F584093E02B6052719F607DACD3A088274F65596BD0D09920B61AB5DA61BBDC7F5049334CF11213945D57E5AC7D055D042B7E024AA2B2F08F0A91260805272DC510515820C6E47AD4FA403B02B4510B647AE3D1770BAC0326A805BBEFD48056C8C121BDB8FF5F5840A2341A098A95305955386A3E0E4E2879E6206342B9C9A8DA0559190E82F3ED1478158F2CA1EF4DB7DEAB124B7C85B0F403D1A968B4812E6C9C9392D926B86DA5582001E23F6C94CFFCC62B02393D7807A6F381E40CA49A9B4A2B522518F72927CA15FF9F5830AC2FCD68B85B64E6C3BC11A9DADD1B24E7786738475CF2FE0ACDD9B41F773AF18EC12601E368D2E920F299F9E6BED4805830A33061A2549EA773D275539B2E92CAA6F936404635DB1DA3199EC71F06FAF2CBA8EFFEF6860BCB0376259A681EF043C35830A3F6177EA5EF5797249DF745BE266271BD65A6A1C9C9FAE2DF3DD2C7E9E6B5751F288FBA11950455A9A1F9A054BAD8545830A5D227C013957479BE181BF43C394A49E8BF14585FD04A4CA72102E3E5AB41661411EEB15986AD3D3A09EB25BB2B7B12583093A152A9CD7D4B81A08989F67FCB958E96B14EF4D3CEFD26AD992059DF4D252A9F00B5F9F2B5B8A59CF4ECA9D78848935830B8CD6DACEEAA3B53D707AE2B99DC87E0DBBF58A1E310CFF5CD3BEA151D90962372DE834A519A879C05BC470A016202D65830A6B5D4A12FAF84AC46DBA1793716CDB14009AF64D0EDCD5F1C0CA872FA53BC5732DA912222FC3D4FC7EA2FC1B9FBFF41FFFFFF"
}

const validTo = Date.now() + (1 * 60 * 60 * 1000); // 1 hour


// User Id (could be tokenName directly). All data passed to sc are hex representation 
const userId = BigInt(`0x${tokenName}`).toString(16);
console.log('User Id:', userId);
let txId = "7A1E56DF9B3535DDDC51783D075E3C28EE223310DBAAD0F8E40FBDD38840CE6B";
let hash = BigInt("10343661163184219313272354919635983875711247223011266158462328948931637363678").toString(16)
// let hash = BigInt("30210038655452570927876935731677491109181541264348558594944850742778338046562").toString(16) // pwd 12345
let pA = "82d5d19cf3e90d5440cd30d1814545ef82f6488ebc8976e16a3b52a9b8c3c70bd117f7c44c1f9bc7408e42c9d7004ab4"
let pB = "854c38232bf1d07fa7f7df0653eeb3a6adbbfb7baf014eac007d4b2c3c906f2d217a138634b42c20437e7480f8f973c81871b23c1161a3ca93219c5d39a19631759e2afb3ca78c357dbc2183dc381b852c08876a66f415c03bfa7310dc303a54"
let pC = "90c5e42f844fec0cfb72f574d0074bbdbde23adbbbf67db3e73d04a20a116f9919bab3bf7a0198453fa7d2e8c9379096"

const zkProof: Record<string, ZKProof> = {
    "26d853c70b2a7979988708b791c674854088712e60c8562d6a4252ab88d74928": {
        userId: userId,
        pwdHash: hash,
        pA: "82d5d19cf3e90d5440cd30d1814545ef82f6488ebc8976e16a3b52a9b8c3c70bd117f7c44c1f9bc7408e42c9d7004ab4",
        pB: "854c38232bf1d07fa7f7df0653eeb3a6adbbfb7baf014eac007d4b2c3c906f2d217a138634b42c20437e7480f8f973c81871b23c1161a3ca93219c5d39a19631759e2afb3ca78c357dbc2183dc381b852c08876a66f415c03bfa7310dc303a54",
        pC: "90c5e42f844fec0cfb72f574d0074bbdbde23adbbbf67db3e73d04a20a116f9919bab3bf7a0198453fa7d2e8c9379096"
    },
    "3b95d108630b49168e549c3c5a2899367118d22d2eb866ac778d21f834f5b3bf": {
        userId: userId,
        pwdHash: hash,
        pA: "b84c55ec3f355e6afd010c4a502919a9d18f6a16a10c3a572402aec3cc0c7415b847c622b36bf8bfe2b3efe073dc6355",
        pB: "822002a6cb9660561edf933e64b943128cdc7976aacff95c7d3f82a08821159745dbd9662624c6292ff39bb7d2578f9d05004ea5ca6c18108e30fc5c2373a5986a469f718c8e6eef11cb45538cc8d6880f1f6469a068e663fe6a4152b9d32fd0",
        pC: "affcb0eed30eb5e63af7fe9b7c9f36dc0a601c78bee7f96b07a3ce2064e1f036c53fd485c771b45e47aaea72e3a5a06b"
    },
    "ae03ed5d7b5feef45e2976baac3614bfe9c821a39c0c90599eee7f0e94cc1661": {
        userId: userId,
        pwdHash: hash,
        pA: "84b04a6de4bf4bb01d8b38b321534048f1cb80fdefd582469f60691daea07e03238b6100ad61d8dcc235e69a78b9233f",
        pB: "8421394b96a18642e1ae26785564375a14df6fa5f690a22279fc9c202269982b458a4a9a9d5d1d9a1a1f649ef66a80ad0c5a871ccf188ee28a7a9c71fe588ff55062b38c7cdbf12af33468d4a4bcc2dff94011b8a729c6ada2f9a663bd4e3bb0",
        pC: "8c3b102c7a45b43c3b0bf3c70807436d0ff2f20877f8109b004fcd6e869cf64c6d5418fc741c029af879788bc004c0bb"
    }
}
// let spendRedeemer = getRedeemer(tokenName, hash, txId, pA, pB, pC);

// let aikenProofCbor = "D8799F5830818C07417BE4D158FDC3604892F140DFF244E2161012AA91352114AB94B74BE21CF4F3CF57FAC49CB9AA4985FDD194CD5F5840ADCCA26FDD822728B1F7B63E3C7018D02FEBD9ADA51B546FB221EB0B980344D05452AD38674CA06190A5780F05DD482819CDE2464912C3AA0D847CD708722977582014A19851DDB787FBC041EC1FF09F8CE38B6231327F151B20F364F1304AA0E971FF5830B7551E8D80C741853A16FBB135C86263ADAACE362E76CD5AAF5264CD920B2839A3CE728656A7743E12FA2625E8FEA9CFFF".toLowerCase();

// const proof: Proof = {
//     pA: "818c07417be4d158fdc3604892f140dff244e2161012aa91352114ab94b74be21cf4f3cf57fac49cb9aa4985fdd194cd",
//     pB: "adcca26fdd822728b1f7b63e3c7018d02febd9ada51b546fb221eb0b980344d05452ad38674ca06190a5780f05dd482819cde2464912c3aa0d847cd70872297714a19851ddb787fbc041ec1ff09f8ce38b6231327f151b20f364f1304aa0e971",
//     pC: "b7551e8d80c741853a16fbb135c86263adaace362e76cd5aaf5264cd920b2839a3ce728656a7743e12fa2625e8fea9cf"
// }
// let lucidProof = Data.to(proof, Proof, { canonical: false });
// console.log('Serialise (Lucid):', lucidProof);
// console.log('Serialise (Aiken):', aikenProofCbor);

console.log('Wallet Address', walletAddress);

const utxo: UTxO = {
    address: spendAddress,
    txHash: "70008140f20476fe33cc3a977b3f7a61a08b1e46e994cb6f7179459d0ecb32f0",
    // txHash: "69667b3128ca08d307b29989b976f5cefeddd15b5e3b5517611aaddd1316c6a4",
    outputIndex: 1,
    assets: { lovelace: BigInt(38_593_550) }
}

const zkInput: ZkInput = {
    userId: userId,
    hash: hash,
    pwd: "1234"
    // pwd: "12345"
}

await spendTx(lucid, [utxoRef], [utxo], spendAddress, spend, lovelace, validTo, walletAddress, zkInput, policyId, tokenName, network, { localUPLCEval: true });