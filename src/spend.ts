import { Blockfrost, CML, Constr, Data, fromText, getAddressDetails, Lucid, Maestro, UTxO } from "@lucid-evolution/lucid";
import { generateSpendScript, getSpendRedeemer, readValidators, ZKProof, ZkInput } from "./prepare-contracts";
import * as fs from 'fs';
import {} from "@lucid-evolution/lucid/dist/index"


// console.log('Deserialise (Lucid-Evolution)', CML.PlutusData.from_cbor_hex("D8799F9FD8799F5820B8B523B596040BB749B23848EA976EE238D5693DCA8DAA3771E17F3874A9C17E00FFFF9FD8799F58203658CF03AB7407F816548E5A465B6F51779BE54BB45F57155776864E454804AC00FFFF9FD8799FD8799FD8799F581C3DCE7844F36B23B8C3F90AFBA40AA188E7F1D3F6E8ACD1D544ED1DA9FFD87A80FF49A140A1401A0098968040D87A80FFD8799FD8799FD8799F581C3DCE7844F36B23B8C3F90AFBA40AA188E7F1D3F6E8ACD1D544ED1DA9FFD87A80FF49A140A1401A025CE88B40D87A80FFFF41A080FF").to_json());

// console.log('Deserialise (Aiken)', CML.PlutusData.from_cbor_hex('D8799F9FD8799F5820B8B523B596040BB749B23848EA976EE238D5693DCA8DAA3771E17F3874A9C17E00FFFF9FD8799F58203658CF03AB7407F816548E5A465B6F51779BE54BB45F57155776864E454804AC00FFFF9FD8799FD8799FD8799F581C3DCE7844F36B23B8C3F90AFBA40AA188E7F1D3F6E8ACD1D544ED1DA9FFD87A80FF49A140A1401A0098968040D87A80FFD8799FD8799FD8799F581C3DCE7844F36B23B8C3F90AFBA40AA188E7F1D3F6E8ACD1D544ED1DA9FFD87A80FF49A140A1401A025CC80F40D87A80FFFF41A080FF').to_json());

// console.log("TX", CML.Transaction.from_cbor_hex("").to_json());
console.log("TX", CML.Transaction.from_cbor_hex("84aa0081825820b017ae1fb9ca68f48872fd5e9d2b2c14edd863ee8863d73739e5123d8e53772600018182583930a8dacf2fd78e734c31a2ee9b28ce4529c0766316bc98a9044c415489a8dacf2fd78e734c31a2ee9b28ce4529c0766316bc98a9044c4154891a002fffae021a00128cb3031a04b9ca16048183098201581ca8dacf2fd78e734c31a2ee9b28ce4529c0766316bc98a9044c4154898200581cc29d40aeb83d3b58adba2834f018800440f89552a28250b8a872f2f20b5820b65490e4eadda205c63c80bd207220d07781a3f70f398d457ba034ecc492d90c0d8182582048444657cfe2aa426f62698de991b4b8340c56752d09727bffb6e7b424bdc8e3001082581d606ce33294813b1feba6a9728d5bf287464d85593730e5ad00367c718f1a004c4b40111a004c4b4012828258201f579023f813aa8936e98ec0b687c80622853d1f12796a5d436f8f40fbf5571e00825820d8a6a486321787e98c07a070e594e86b2954c1a21c0894604e36fb40a64e00bf00a20582840000d8799f000000d8799fd8799f582073eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff000000005820e7db4ea6533afa906673b0101343b00aa77b4805fffcb7fdfffffffe00000001582073eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000000ffffd8799fd8799f5830af46f51c9067ff3f6ae57ba0f76d9de33e979d01c0f91a40fc600f467b8fd0a3804d1968c2836632d728450b5d2614d45f5840816dc1b644722dcaf92aba79949fb514b19f0289dec36e9d49e9fec755244636e321ac6e6d37cc78381fc37eced6e5d7057e8187d6fd098df96471461545658058200cbd3f64a809bb4e565416c967c60ad6e32f83a9def38b0ad5ba826ec45a1e0aff58308881425d2cf63d3e019a4eb858b79d536804ce76ee499dc562cf0bac94db104963f7599c96ee98b2f47c58a780c62980ffffff821a0049fa1e1af9668f32840200d87c80821a0005dfd51a06ecd9cf07815924775924740101003323232323232323232323232323232323232323222533300e32323232323232323232323232323232323232532333022300e00f1323232533333302d014132325333027300e3029375402c264a66605800203a264a66666606200203c03c03c26464a66605e002040264a66666606800204204204226464a666064002046264a66666606e00204804804826464a66606a00204c264a666666074002264a66606e002050264a6666660780022a6660706076004266601e006266601c00226464646464646464646464a66607e605660826ea8c11400854ccc0fd4ccc0fc004528099981fa504a0944528899191919191919191919192999825181898261baa012132533304b3032304d375402426464a6609c66e592401107478206368616c6c656e676549643a200037326605e6ea4005220100153304e3372c9201157369676e616c73206368616c6c656e676549643a200037326605e605a60a06ea800d220100153304e3372c920114697320666f72206576616c756174696f6e3f3a200037326605e66609a008980103d87a80004c0103d87980004881001323232533305030373052375400226464a6660a4606260a86ea80044c94cccccc16c00454ccc14cc0e8c154dd5000899299982c000825099299999982e80082582582582589919299982d800826899299999983000082702702702709919299982f0008280992999999831800828828828828899192999830800829899299999983300082a02a02a02a09919299983200082b099299999983480082b82b8992999833183480189919800800801111929998348010992999833182698341baa0011325333067304630693754002264a660d266e592410e4163636f756e74446174756d3a20003732660940029101001533333307000115333068304f306a3754002264a6660da0020c0264a6666660e40020c20c20c20c226464a6660e00020c6264a6666660ea0020c80c80c80c826464a6660e60020cc264a6666660f00020ce0ce0ce0ce264a6660ea60f00062a660e466e5924010e646174756d207573657249643a20003732660a66ea401d220100153330713371e05a00e2a660e466e592410d706172616d7320686173683a20003732660a66ea40ad220100153330713371e0560082a6660e266e3c0a400454cc1c8cdcb249107369676e616c73207573657249643a20003732660a660a460e86ea809d220100153330713371e6eb8c148c1d0dd50138038a9983919b9649010c646174756d20686173683a20003732660a66ea401122010015330723372c92010e7369676e616c7320686173683a20003732660a6604260e86ea809d220100153330713371e6eb8c084c1d0dd50138020991919299983a182d983b1baa001132325333076305d30783754002264646464a6660f460c260f86ea80084c94cc1f0cdcb24811175736572496420286e756d626572293a20003732660ba6ea001d220100153307c3372c9201127077644861736820286e756d626572293a20003732660ba6ea0015220100153307c3372c9201146368616c6c656e676520286e756d626572293a20003732660ba6ea0005220100153307c3372c92010a6f766572666c6f773a20003732660ba6ea0009220100132323232533307f036133307f533307f33300103400402d14a22a6610002921267a6b5f7665726966792870726f6f662c207075626c69632c207a6b657929203f2046616c73650014a0941288a99983f99980081a0020168a51153308001491267a6b5f7665726966792870726f6f662c207075626c69632c207a6b657929203f2046616c73650014a044466f18cde21bbb375c60c46108026ea800cde11bae3061308401375400666f14cde299bc437766eb8c188c21004dd50009bc2375c60c26108026ea8004cde2192999843008008a9984180a491077726f6e6720766b5f69632073697a650016132333006308a0100200437760026eb8c22004004dd61843809844009844009844009844009842009baa00137846eb8c0c4c21004dd500099bc437766eb8c0c4c21004dd50019bc2375c610e026110026110026110026108026ea8004c00400488894ccc2100400c40044c8c94ccc21804010584cccc018018004c22404010cddb00199bb8375a6110020086eec008c22004010dd718430080199840009ba80073308001375000a66100026ea0004cc20004dd400399840009ba80013308001375000a97ae0375a61000260fa6ea800854cc1ed241546578706563742028536f6d65287363616c61725f6368616c6c656e6765292c206f766572666c6f7729203d0a2020202020202020746f5f7363616c61725f6f766572666c6f77286368616c6c656e67655f6964290016375a60fe61000200460fc0026464a6660f260ca60f66ea80044cc1f8c020cdc300124105010101c1fffffffff7bfcbff7f0349f79d550177d1091161cf330753bf9d534d3bdb7c1c660fc9810101004bd7009983f0009983f2610100004bd70180380099bca4a20566eb4c1f0c1e4dd50008a9983ba4814165787065637420536f6d65287363616c61725f6861736829203d207363616c61722e66726f6d5f6279746561727261795f6269675f656e6469616e28686173682900163003008375a60f460ee6ea800454cc1d52414765787065637420536f6d65287363616c61725f757365725f696429203d207363616c61722e66726f6d5f6279746561727261795f6269675f656e6469616e28757365725f69642900163001009230023379494400494ccc1c94ccc1c8cdc4a4000002266e200052082808080e0fffffffffbdfe5ffbf81a4fbceaa80bbe88488b0e79983a9dfcea9a69dedbe0e14a0260ba660ee6ea00052f5c02980103d87a800015330724911b657870656374207369676e616c732e68617368203d3d20686173680016153307249121657870656374207369676e616c732e757365725f6964203d3d20757365725f6964001615330724911a65787065637420616464725f6e6f6e6365203d3d206e6f6e63650016153307249117657870656374207077645f68617368203d3d2068617368001615330724911c6578706563742061737365745f6e616d65203d3d20757365725f69640016068375c00260ea00260ea0066eb8004c1c8004c1c800cdd7000983780098359baa00105f05f05f05f05f306d306a37540022a660d092013565787065637420496e6c696e65446174756d286461746129203d206163636f756e745f696e7075742e6f75747075742e646174756d0016301630693754608c60d26ea8c1b0c1a4dd50008a99833a496c65787065637420536f6d65286163636f756e745f696e70757429203d0a20202020202020207265666572656e63655f696e707574730a202020202020202020207c3e2066696e645f6163636f756e745f696e70757428706f6c6963795f69642c2061737365745f6e616d6529001633017029230523330503756608c60d26ea8c118c1a4dd5000813011099299999983700082e02e02e02e099180198370021bae001306b002300200205837580020ae0ae60cc00260cc0066eb8004c18c004c18c00cdd7000983000098300019bae001305d001305d003375c00260b400260ac6ea8004124124124124124c160c154dd50008a99829a493d65787065637420496e6c696e65446174756d28636972637569745f6461746129203d20636972637569745f696e7075742e6f75747075742e646174756d0016300130543754606260a86ea8c15cc150dd50011182b982c182c0008a99828a497465787065637420536f6d6528636972637569745f696e70757429203d0a20202020202020207265666572656e63655f696e707574730a202020202020202020207c3e2066696e645f636972637569745f696e70757428706f6c6963795f69642c20636972637569745f61737365745f6e616d65290016330010132325333051303d30533754002264a660a666e592410b706f6c6963795f69643a20003732660686ea404922010015330533372c92010d7363726970745f686173683a20003732660686ea40052201001533305253330523371e024002294454cc14d24120706f6c6963795f6964203d3d207363726970745f68617368203f2046616c73650014a02607c6660786eacc0c8c154dd51819182a9baa00301201014a06eb8c15cc150dd50008a50303130533754606260a66ea8c0c0c14cdd500091191980080080191299982b0008a6103d87a800013232533305430050021303f330590024bd70099802002000982d001182c000a991998270028a999827299982718008010a5113001375c605c60a26ea8010526153304f4915c6578706563740a202020202020202020207369676e616c732e6368616c6c656e6765203d3d206368616c6c656e67655f6964207c7c207369676e616c732e6368616c6c656e6765203d3d207369676e616c732e6368616c6c656e676500161533304e3001002149854cc13d240128657870656374207369676e616c732e6368616c6c656e6765203d3d206368616c6c656e67655f69640016371e6eb8c0b4c140dd500199191b94001376600264646464646464607c660b06e9cc014dd6182c8019982c1ba73005375860b2008660b06e9cccc018dd6182c80125eb8088c8c8c8cc174c10ccc174c17800ccc174dd498061bab305e0023305d37526464a6660b4608200229101001533305a30460011375c60c060ba6ea80084c8c8dca0009bb30013060305d375400460b66ea8004c178004cc174c178c17c0052f5c000860bc00260ba00260b06ea8008cc160dd498039bab3059001330583059305a0014bd70182c982c800982c000982b80098291baa04023330020014bd70111982b182b982a1baa002001222323300100100422533305600110041330033058001330020023059001237666e98004c144c138dd50090a9982624811c65787065637420536f6d652870726f6f6629203d20725f70726f6f6600163050304d37540242a6609692012065787065637420536f6d65287369676e616c7329203d20725f7369676e616c7300163035304b3754609e60a00046eb8c138004c138008dd7182600098260011bae304a001304a002375c609000260900046eb8c118004c108dd50198a998202481636578706563742028547275652c206576616c5f7468697329203d0a2020202020206576616c756174696e675f7363726970742873656c665f6964782c206964782c206a64782c2073656c665f7265662c20696e707574732c2072656465656d657273290016302a304037546088608a0026666664644444464a66608a6058608e6ea80044c94ccc118cdd7811981398249baa00113253330473033304937540022a66608e6464a666092606060966ea80044c8c94ccc12cc0dcc134dd50008a99982599b8f375c60a2609c6ea80040104c94ccc130c0ccc138dd5000899299999982a8008a999826981a18279baa001132533305200104d132533333305700104e04e04e132325333055001050132533333305a001051051051132325333058001053132533333305d00105405405413232533305b0010561325333333060001132533305d00105813253333330620011533305e3061002133303500313330340011533305a3370e034010266e1c02001452802c82c82c82c82c82c82c982f800982f80102b82b82b82b982e800982e8019bad001054305a001305a003375a0020a260ae00260ae0066eb4004138c150004c140dd5000826026026026026182918279baa001153304d4915765787065637420536f6d652872656465656d657229203d0a20202020202070616972732e6765745f66697273742872656465656d6572732c205370656e6428696e7075742e6f75747075745f7265666572656e63652929001632323300100100a22533305200114c0103d87a8000132323253330513375e00c60a600626078660ac00297ae01330050050023053002305600230540013374a900119828181618271baa0024bd700a50153304c4914465787065637420536372697074287363726970745f6861736829203d20696e7075742e6f75747075742e616464726573732e7061796d656e745f63726564656e7469616c0016302b304d37546056609a6ea8c0a8c134dd5000982798261baa001153304a49012b65787065637420536f6d6528696e70757429203d206c6973742e617428696e707574732c20696e6465782900163300a006008375c609a60946ea80044cc130ccc11d28a60103d87a80004c0103d87980003304c3330473370e00e00c980103d87a80004c0103d87980004bd700a9982419b96491367478206973206e6f74206576616c756174696e67206e656974686572207468697320736372697074206f7220617420696e6465783a20003732660526ea001d22010014bd708103d87980008103d87980000a998242494b65787065637420536372697074287363726970745f6861736829203d207363726970745f696e7075742e6f75747075742e616464726573732e7061796d656e745f63726564656e7469616c0016302730493754604e60926ea8c098c124dd50008a99823a49306578706563742073656c665f726566203d3d207363726970745f696e7075742e6f75747075745f7265666572656e63650016304b304837540022a6608c92013565787065637420536f6d65287363726970745f696e70757429203d206c6973742e617428696e707574732c2073656c665f696478290016330060020053001001222533304400214c0103d87a800013232533304230290031302d330470024bd7009998028028009813001982400198230011bad3043009375a60860106eb4c10c01cdd618218019bab304330443044304430443044304430443044002375860840026084002607a6ea80acc0fcc100008c0f8004c0f8004c0f4004c0f0004c0dcdd5011814814814814814814814981c800981c801013813813813981b800981b8019bad00102430340013034003375a002042606200260620066eb4004078c0b8004c0a8dd500b00e11119299981518088008992999817800801899299999981a0008a99981818198010a999816180998171baa00113253330310010051325333333036001006006006006132325333034001008132533333303900100900900900913232533303700100b132533333303c00100c00c00c00c1325333039303c0031500e00d375c002607200260720066eb8004c0d8004c0d800cdd7000981980098179baa0010040040040040040043031001302d37540082a666054602c0022a66605c605a6ea80105400c008008c0acdd50019111929998149808000899299981700080189929999998198008a99981798190010a999815980918169baa00113253330300010051325333333035001006006006006132325333033001008132533333303800100900900900913232533303600100b132533333303b00100c00c00c00c1325333038303b0031500e00d375c002607000260700066eb8004c0d4004c0d400cdd7000981900098171baa0010040040040040040043030001302c37540082a666052602a0022a66605a60586ea80105400c008008c0a8dd500180d00d00d00d18151815801181480098129baa010132323253323302630010131323232533333303101813232533302b30120011533302f302e37540342a0040462a666056602e0022a66605e605c6ea80685400808c54ccc0acc02800454ccc0bcc0b8dd500d0a8010118a99981598030008a99981798171baa01a15002023023302c37540322646464646464a64666060602e0042a666060602e60646ea80204c8c8c94ccc0ccc07cc0d4dd5001099299981a1810181b1baa0021533035300537326602c6ea400522100132533303900902f132533303a303d00a153330363330143017303937540020069444cdc398099bab30163039375400266e040080240c40c0c0ec024cc0400280040b4dd7181c981b1baa00202c303830390023037001303337540100522a66606060380042a666060601660646ea80204c8c8c8c8c94ccc0d4c084c0dcdd5002099299981b180e981c1baa003153303730073732660306ea4005221001533303653330363370e0049040497a008a51153303749012b6465706f736974203d3d207374616b65526567697374726174696f6e4465706f736974203f2046616c73650014a0264a666076016062264a666078607e0182a66607066602c603260766ea800400d28899b8730153756603060766ea8004cdc099b8100200400b033032303d00b3301200c00114a00646eb8c0ecc0e0dd50020189bad303a303b002303900130390023037001303337540100582a666060601e0042a666060601e60646ea80204c8c8c94ccc0ccc07cc0d4dd5001099299981a180d981b1baa0021533035300537326602c6ea4005220100132533303900902f132533303a303d00a153330363330143017303937540020069444cdc398099bab30163039375400266e040080240c40c0c0ec024cc0400280040c4dd7181c981b1baa0020303038303900230370013033375401005a2a666060601e60646ea80204c8c8c94ccc0ccc07cc0d4dd5001099299981a1810181b1baa0021533035300537326602c6ea4005220100132533303900902f132533303a303d00a153330363330143017303937540020069444cdc398099bab30163039375400266e040080240c40c0c0ec024cc0400280040c8dd7181c981b1baa0020313038303900230370013033375401005c6e592410d73637269707420686173683a20003030375403a6eb4c0ccc0d0008dd61819000981918190011bac3030001302c3754034042042042042605c605e0046eb4c0b4004c0a4dd500a1b874801854ccc094c0100484c8c8c8c8c8c8c8c94ccc0b4c064c0bcdd5004099192999819803014899299981a181b8038a999818199807180898199baa0010034a226464a6606666e5924112696e70757473206c6f76656c6163653a3a20003732660286ea001122010015330333372c9201126f7574707574206c6f76656c6163653a3a20003732660286ea000922010015330333372c9201167265776172647320746f2077697468647261773a3a20003732660286ea000522010015330333372c9201066665653a3a20003732660286ea001d22010013370e00466e04cdc000200080399199800800991980080080391299981c0008a5eb804c8c8c94ccc0dccdd7809181c80189981e1ba800133005005002133005005002375a6072004607800460740029000111299981c00108008999801801981d80119b80375a6074004002601a6eacc040c0ccdd5000815815181a803198050038009bae3033303037540102a6605c92012765787065637420536372697074287363726970745f6861736829203d2063726564656e7469616c0016375660646066606660660046eb4c0c4004c0c4008dd61817800981798178011bac302d0013029375402e605660506ea804c5888c8ccc00400400d2000222533302d00210011333003003303000232533302a333008300b302d37546014605a6ea800401528899b80002300737566014605a6ea8c028c0b4dd50008a99815a481416578706563742069735f7363726970745f6164647265737328696e7075742e6f75747075742e616464726573732c207363726970745f686173682c2054727565290016302f002233300e0014890048810022232323253330283014302a37540042a66605066e3cdd7181718159baa0020051533302800413253330293010302b3754004264a666054602260586ea80044c94ccc0acc05cc0b4dd5000899b8f375c6062605c6ea800402000cc0c0c0b4dd5000801181798161baa00200114a0294454cc0a524122657870656374207061796d656e745f68617368203d3d207363726970745f68617368001615330294913065787065637420536372697074287061796d656e745f6861736829203d207061796d656e745f63726564656e7469616c0016302d302e002302c001302837540066e1d200423027302800123026001300100122253332333302900313232323232323300d002001337149110128000025333025337100069007099b80483c80400c54ccc094cdc4001a410004266e00cdc0241002800690068b2999814000899b8a4881035b5d2900005133714911035b5f2000333300900133714911025d2900005223330090090023006001223330090090020013758604c0046eb4c090004c8cdd81ba83024001374e604a0026ea800c4c94ccc0980044cdc52441027b7d00003133714911037b5f2000323233001001003225333029001100315333029302c0011323330090093028001337149101023a20003330090093029001004302b0011323330090093028001337149101023a20003330090093029001300633003003302d002302b0013371491102207d000033756006264a66604c002266e29221025b5d00003133714911035b5f2000333300700133714911015d000032233300700700230040012233300700700200137580066e292201022c2000133006375a0040022646466e29220102682700001323330010013006371a00466e292201012700003222533302433710004900008008991919199803003180580299b8b33700004a66604e66e2000920141481805206e3371666e000054ccc09ccdc4000a4028290300a40dc00866e18009202033706002901019b8e004002375c0046e0120012222323300100100522533302500110051533302530280011330033027001005133004302700133002002302800122323300100100322533301e300500113371491010130000031533301e337100029000099b8a489012d003300200233702900000089980319b8400148050cdc599b803370a002900a240c00066e1d20003001001222533301a3371200490000800899980180199b8400248050cdc599b803370a004900a240c000244464a666034600c60386ea8004520001375a6040603a6ea8004c94ccc068c018c070dd50008a6103d87a80001323300100137566042603c6ea8008894ccc080004530103d87a80001323232325333020337220100042a66604066e3c0200084c02ccc094dd4000a5eb80530103d87a8000133006006003375a60440066eb8c080008c090008c088004c8cc004004010894ccc07c0045300103d87a8000132323232533301f337220100042a66603e66e3c0200084c028cc090dd3000a5eb80530103d87a8000133006006003375660420066eb8c07c008c08c008c084004dd2a40006e1d20023015375400260306032004602e002602e004602a00260226ea8004526153300f49011856616c696461746f722072657475726e65642066616c73650013656153300c49011772656465656d65723a205370656e6452656465656d65720016153300b4912d657870656374207a6b65793a205a6b566572696669636174696f6e4b6579203d20636972637569745f646174610016153300a49133657870656374204163636f756e74446174756d207b20757365725f69642c20686173682c206e6f6e6365207d203d2064617461001615330094911972656465656d65723a205075626c69736852656465656d6572001615330084917865787065637420526567697374657243726564656e7469616c207b0a2020202020202020202063726564656e7469616c3a20536372697074287363726970745f68617368292c0a202020202020202020206465706f7369743a204e657665722c0a20202020202020207d203d2063657274696669636174650016153300749119657870656374205b6f75747075745d203d206f757470757473001615330064913b6578706563742069735f7363726970745f61646472657373286f75747075742e616464726573732c207363726970745f686173682c20547275652900161533005491b0657870656374205265676973746572416e6444656c656761746543726564656e7469616c207b0a2020202020202020202063726564656e7469616c3a20536372697074287363726970745f68617368292c0a2020202020202020202064656c65676174653a2044656c6567617465426c6f636b50726f64756374696f6e207b202e2e207d2c0a202020202020202020206465706f7369742c0a20202020202020207d203d20636572746966696361746500161533004491926578706563742044656c656761746543726564656e7469616c207b0a2020202020202020202063726564656e7469616c3a20536372697074287363726970745f68617368292c0a2020202020202020202064656c65676174653a2044656c6567617465426c6f636b50726f64756374696f6e207b202e2e207d2c0a20202020202020207d203d20636572746966696361746500161533003491876578706563742044656c656761746543726564656e7469616c207b0a2020202020202020202063726564656e7469616c3a20536372697074287363726970745f68617368292c0a2020202020202020202064656c65676174653a2044656c6567617465566f7465207b202e2e207d2c0a20202020202020207d203d2063657274696669636174650016153300249130657870656374205370656e6452656465656d6572207b206964782c206a64782c202e2e207d203d2072656465656d657200165734ae7155ceaab9e5573eae815d0aba2574898184d8799f581c3c692631872308ff1f9fed102b940aecee160def9c2478b50b9770914b43697263756974233030304a466f6e74757323303037582016de4e0412334a7a78664ef6307117e601c9db5213b7ea96a1edf1d1fab543de582434363763373738352d623731612d343433662d396237332d313132633134653034373135d87980ff0001f5f6").to_json());

// const network = "Preprod";
const network = "Preview";
const lucid = await Lucid(
    new Blockfrost(
        "https://cardano-preview.blockfrost.io/api/v0",
        "preview1OQSKlQ6tb3WYBx9bqlz7kDFhuglmfvL"
        // "https://cardano-preprod.blockfrost.io/api/v0",
        // "preprodNQK7GqWxfMkWg9x5j4bHOVBNNGpjmxQv"
    ),
    network
);
// const lucid = await Lucid(
//     new Maestro({
//         apiKey: "M4tGNWFPzrC35t3HW5LVEkcH8tvO0FkS",
//         network
//     }),
//     network
// );

console.log("Data:", Data.to(new Constr(0, [])))
const MyDatumSchema = Data.Enum([
    Data.Literal("Left"),
    Data.Literal("Down"),
  ]);

  type MyDatum = Data.Static<typeof MyDatumSchema>;
  const MyDatum = MyDatumSchema as unknown as MyDatum;

  const datumLeft: MyDatum = "Left";
  console.log("Left:", Data.to(datumLeft, MyDatum));

const prvKey = fs.readFileSync('./src/me.sk').toString();
lucid.selectWallet.fromPrivateKey(prvKey);
// const walletAddress = await lucid.wallet().address();
const walletAddress = "addr_test1qzw567xyzgqchtyddeha90ugsr8uyu7h4uh8wg5su8qz7yykq2ndwcmedv72l7263vj96tl6cyn74l2mw5kp8h7fk8rq66qtae";

const policyId = "b8a5e329b500a66376047165cdfce62c3ecf245fd81d101533f81422";
const lovelace = 10_000_000n;
const tokenName = fromText('Fontus#000');
console.log('Token Name:', tokenName);
const assetUnit = `${policyId}${tokenName}`;

const validators = readValidators();
const { spend, spendAddress } = generateSpendScript(validators.spend.script, network, policyId, tokenName);
console.log('Spend Address:', spendAddress);
// console.log('Spend Script:', spend);

const utxoRef: UTxO = {
    address: "addr_test1vq7uu7zy7d4j8wxrly90hfq25xyw0uwn7m52e5w4gnk3m2gprf2za",
    // address: spendAddress,
    txHash: "d6da036c1aeb7680323258c763a2a6e25be9b280c2a8fedd5e43cb89730fdadf",
    // txHash: "0000000000000000000000000000000000000000000000000000000000000000",
    outputIndex: 0,
    // assets: { lovelace: BigInt(4_219_490), ["b8a5e329b500a66376047165cdfce62c3ecf245fd81d101533f81422466f6e74757323303030"]: BigInt(1) },
    assets: { lovelace: 4_366_030n, [assetUnit]: 1n },
    datum: "d8799f4a466f6e74757323303030582016de4e0412334a7a78664ef6307117e601c9db5213b7ea96a1edf1d1fab543ded8799f5830b18db01619508d589ba45cdcc9c9ab4dbddc33e08bc4dbddea565c10dc743fd66510d3f49c6343999caf540eaa0c4e035f5840845f7a4f6d0fbcaf0648d9c2657f19a33f4e2124c284d68688f209abf54d5a1d1afc47de55c24e662c47f7632a760a8016e8ba01eb4b0d4a2db67fe5abed5ae15820a09e035dbe984a1426e440a4f0038276792f87cdb2bc35dc185a618d352d7f54ff5f584093e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc510515820c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8ff5f5840a2341a098a95305955386a3e0e4e2879e6206342b9c9a8da0559190e82f3ed1478158f2ca1ef4db7deab124b7c85b0f403d1a968b4812e6c9c9392d926b86da5582001e23f6c94cffcc62b02393d7807a6f381e40ca49a9b4a2b522518f72927ca15ff9f5830ac2fcd68b85b64e6c3bc11a9dadd1b24e7786738475cf2fe0acdd9b41f773af18ec12601e368d2e920f299f9e6bed4805830a33061a2549ea773d275539b2e92caa6f936404635db1da3199ec71f06faf2cba8effef6860bcb0376259a681ef043c35830a3f6177ea5ef5797249df745be266271bd65a6a1c9c9fae2df3dd2c7e9e6b5751f288fba11950455a9a1f9a054bad8545830a5d227c013957479be181bf43c394a49e8bf14585fd04a4ca72102e3e5ab41661411eeb15986ad3d3a09eb25bb2b7b12583093a152a9cd7d4b81a08989f67fcb958e96b14ef4d3cefd26ad992059df4d252a9f00b5f9f2b5b8a59cf4eca9d78848935830b8cd6daceeaa3b53d707ae2b99dc87e0dbbf58a1e310cff5cd3bea151d90962372de834a519a879c05bc470a016202d65830a6b5d4a12faf84ac46dba1793716cdb14009af64d0edcd5f1c0ca872fa53bc5732da912222fc3d4fc7ea2fc1b9fbff41ffffff"
    // datum: "D8799F58200000000000000000000000000000000000000000000000000000000000000237D8799F5830B18DB01619508D589BA45CDCC9C9AB4DBDDC33E08BC4DBDDEA565C10DC743FD66510D3F49C6343999CAF540EAA0C4E035F5840845F7A4F6D0FBCAF0648D9C2657F19A33F4E2124C284D68688F209ABF54D5A1D1AFC47DE55C24E662C47F7632A760A8016E8BA01EB4B0D4A2DB67FE5ABED5AE15820A09E035DBE984A1426E440A4F0038276792F87CDB2BC35DC185A618D352D7F54FF5F584093E02B6052719F607DACD3A088274F65596BD0D09920B61AB5DA61BBDC7F5049334CF11213945D57E5AC7D055D042B7E024AA2B2F08F0A91260805272DC510515820C6E47AD4FA403B02B4510B647AE3D1770BAC0326A805BBEFD48056C8C121BDB8FF5F5840A2341A098A95305955386A3E0E4E2879E6206342B9C9A8DA0559190E82F3ED1478158F2CA1EF4DB7DEAB124B7C85B0F403D1A968B4812E6C9C9392D926B86DA5582001E23F6C94CFFCC62B02393D7807A6F381E40CA49A9B4A2B522518F72927CA15FF9F5830AC2FCD68B85B64E6C3BC11A9DADD1B24E7786738475CF2FE0ACDD9B41F773AF18EC12601E368D2E920F299F9E6BED4805830A33061A2549EA773D275539B2E92CAA6F936404635DB1DA3199EC71F06FAF2CBA8EFFEF6860BCB0376259A681EF043C35830A3F6177EA5EF5797249DF745BE266271BD65A6A1C9C9FAE2DF3DD2C7E9E6B5751F288FBA11950455A9A1F9A054BAD8545830A5D227C013957479BE181BF43C394A49E8BF14585FD04A4CA72102E3E5AB41661411EEB15986AD3D3A09EB25BB2B7B12583093A152A9CD7D4B81A08989F67FCB958E96B14EF4D3CEFD26AD992059DF4D252A9F00B5F9F2B5B8A59CF4ECA9D78848935830B8CD6DACEEAA3B53D707AE2B99DC87E0DBBF58A1E310CFF5CD3BEA151D90962372DE834A519A879C05BC470A016202D65830A6B5D4A12FAF84AC46DBA1793716CDB14009AF64D0EDCD5F1C0CA872FA53BC5732DA912222FC3D4FC7EA2FC1B9FBFF41FFFFFF"
}

const validTo = Date.now() + (1 * 60 * 60 * 1000); // 1 hour


// User Id (could be tokenName directly). All data passed to sc are hex representation 
const userId = BigInt(`0x${tokenName}`).toString(16);
const pwdHash = BigInt(`0x${"16de4e0412334a7a78664ef6307117e601c9db5213b7ea96a1edf1d1fab543de"}`).toString(16);
console.log('User Id:', userId);
let txId = "7A1E56DF9B3535DDDC51783D075E3C28EE223310DBAAD0F8E40FBDD38840CE6B";
let hash = BigInt("10343661163184219313272354919635983875711247223011266158462328948931637363678").toString(16)
console.log('PWD HASH (from hex number):', hash)
// let hash = BigInt("30210038655452570927876935731677491109181541264348558594944850742778338046562").toString(16) // pwd 12345
let pA = "82d5d19cf3e90d5440cd30d1814545ef82f6488ebc8976e16a3b52a9b8c3c70bd117f7c44c1f9bc7408e42c9d7004ab4"
let pB = "854c38232bf1d07fa7f7df0653eeb3a6adbbfb7baf014eac007d4b2c3c906f2d217a138634b42c20437e7480f8f973c81871b23c1161a3ca93219c5d39a19631759e2afb3ca78c357dbc2183dc381b852c08876a66f415c03bfa7310dc303a54"
let pC = "90c5e42f844fec0cfb72f574d0074bbdbde23adbbbf67db3e73d04a20a116f9919bab3bf7a0198453fa7d2e8c9379096"

const zkProof: Record<string, ZKProof> = {
    "26d853c70b2a7979988708b791c674854088712e60c8562d6a4252ab88d74928": {
        userId: userId,
        pwdHash: hash,
        pA: "82d5d19cf3e90d5440cd30d1814545ef82f6488ebc8976e16a3b52a9b8c3c70bd117f7c44c1f9bc7408e42c9d7004ab4",
        pB: "854c38232bf1d07fa7f7df0653eeb3a6adbbfb7baf014eac007d4b2c3c906f2d217a138634b42c20437e7480f8f973c81871b23c1161a3ca93219c5d39a19631759e2afb3ca78c357dbc2183dc381b852c08876a66f415c03bfa7310dc303a54",
        pC: "90c5e42f844fec0cfb72f574d0074bbdbde23adbbbf67db3e73d04a20a116f9919bab3bf7a0198453fa7d2e8c9379096"
    },
    "3b95d108630b49168e549c3c5a2899367118d22d2eb866ac778d21f834f5b3bf": {
        userId: userId,
        pwdHash: hash,
        pA: "b84c55ec3f355e6afd010c4a502919a9d18f6a16a10c3a572402aec3cc0c7415b847c622b36bf8bfe2b3efe073dc6355",
        pB: "822002a6cb9660561edf933e64b943128cdc7976aacff95c7d3f82a08821159745dbd9662624c6292ff39bb7d2578f9d05004ea5ca6c18108e30fc5c2373a5986a469f718c8e6eef11cb45538cc8d6880f1f6469a068e663fe6a4152b9d32fd0",
        pC: "affcb0eed30eb5e63af7fe9b7c9f36dc0a601c78bee7f96b07a3ce2064e1f036c53fd485c771b45e47aaea72e3a5a06b"
    },
    "ae03ed5d7b5feef45e2976baac3614bfe9c821a39c0c90599eee7f0e94cc1661": {
        userId: userId,
        pwdHash: hash,
        pA: "84b04a6de4bf4bb01d8b38b321534048f1cb80fdefd582469f60691daea07e03238b6100ad61d8dcc235e69a78b9233f",
        pB: "8421394b96a18642e1ae26785564375a14df6fa5f690a22279fc9c202269982b458a4a9a9d5d1d9a1a1f649ef66a80ad0c5a871ccf188ee28a7a9c71fe588ff55062b38c7cdbf12af33468d4a4bcc2dff94011b8a729c6ada2f9a663bd4e3bb0",
        pC: "8c3b102c7a45b43c3b0bf3c70807436d0ff2f20877f8109b004fcd6e869cf64c6d5418fc741c029af879788bc004c0bb"
    }
}
// let spendRedeemer = getRedeemer(tokenName, hash, txId, pA, pB, pC);

// let aikenProofCbor = "D8799F5830818C07417BE4D158FDC3604892F140DFF244E2161012AA91352114AB94B74BE21CF4F3CF57FAC49CB9AA4985FDD194CD5F5840ADCCA26FDD822728B1F7B63E3C7018D02FEBD9ADA51B546FB221EB0B980344D05452AD38674CA06190A5780F05DD482819CDE2464912C3AA0D847CD708722977582014A19851DDB787FBC041EC1FF09F8CE38B6231327F151B20F364F1304AA0E971FF5830B7551E8D80C741853A16FBB135C86263ADAACE362E76CD5AAF5264CD920B2839A3CE728656A7743E12FA2625E8FEA9CFFF".toLowerCase();

// const proof: Proof = {
//     pA: "818c07417be4d158fdc3604892f140dff244e2161012aa91352114ab94b74be21cf4f3cf57fac49cb9aa4985fdd194cd",
//     pB: "adcca26fdd822728b1f7b63e3c7018d02febd9ada51b546fb221eb0b980344d05452ad38674ca06190a5780f05dd482819cde2464912c3aa0d847cd70872297714a19851ddb787fbc041ec1ff09f8ce38b6231327f151b20f364f1304aa0e971",
//     pC: "b7551e8d80c741853a16fbb135c86263adaace362e76cd5aaf5264cd920b2839a3ce728656a7743e12fa2625e8fea9cf"
// }
// let lucidProof = Data.to(proof, Proof, { canonical: false });
// console.log('Serialise (Lucid):', lucidProof);
// console.log('Serialise (Aiken):', aikenProofCbor);

console.log('Wallet Address', walletAddress);

const utxo: UTxO = {
    address: spendAddress,
    txHash: "70008140f20476fe33cc3a977b3f7a61a08b1e46e994cb6f7179459d0ecb32f0",
    // txHash: "69667b3128ca08d307b29989b976f5cefeddd15b5e3b5517611aaddd1316c6a4",
    outputIndex: 1,
    assets: { lovelace: BigInt(38_593_550) }
}

const zkInput: ZkInput = {
    userId: userId,
    hash: hash,
    pwd: "1234"
    // pwd: "12345"
}

// console.log("CHALLENGE", CML.PlutusData.from_cbor_hex("D8799F9FD8799F58201F579023F813AA8936E98EC0B687C80622853D1F12796A5D436F8F40FBF5571E00FFD8799F5820091240A11C67B121A8E5613E3EC58A67E3C107C0F5C900BBFC416A79203AFE6900FFFF9FD8799F58205EB7695DD521C1B032C48C38CFD9C6E6F418C5DBDB3588999C5BC0FDA8BF101C00FFFF9FD8799FD8799FD87A9F581C3C692631872308FF1F9FED102B940AECEE160DEF9C2478B50B977091FFD8799FD8799FD87A9F581C3C692631872308FF1F9FED102B940AECEE160DEF9C2478B50B977091FFFFFFFF49A140A1401A001E848040D87A80FFD8799FD8799FD87A9F581C2001B7FBB6F955482EDC974B2AFD47CA11D259707E0E5207498EB595FFD8799FD8799FD87A9F581C2001B7FBB6F955482EDC974B2AFD47CA11D259707E0E5207498EB595FFFFFFFF49A140A1401A006820EE40D87A80FFFF41A080FF").to_json())
// console.log("CHALLENGE OFF-CHAIN", CML.PlutusData.from_cbor_hex("D8799F9FD8799F58201F579023F813AA8936E98EC0B687C80622853D1F12796A5D436F8F40FBF5571E00FFD8799F5820091240A11C67B121A8E5613E3EC58A67E3C107C0F5C900BBFC416A79203AFE6900FFFF9FD8799F58205EB7695DD521C1B032C48C38CFD9C6E6F418C5DBDB3588999C5BC0FDA8BF101C00FFFF9FD8799FD8799FD8799F581CE52DED0F93F2CB669317A6AE9B1316A7182E5EF40FD0C6D934CF62F2FFD8799FD8799FD8799F581C7E6D90260A406824D6D4B5AE7A2F48BED1E47881C7E4468D06FFBFA0FFFFFFFF49A140A1401A001E848040D87A80FFD8799FD8799FD87A9F581C2001B7FBB6F955482EDC974B2AFD47CA11D259707E0E5207498EB595FFD8799FD8799FD87A9F581C2001B7FBB6F955482EDC974B2AFD47CA11D259707E0E5207498EB595FFFFFFFF49A140A1401A006820EE40D87A80FFFF41A080FF").to_json())

// await spendTx(lucid, [utxoRef], [utxo], spendAddress, spend, lovelace, validTo, walletAddress, zkInput, policyId, tokenName, network, { localUPLCEval: true });